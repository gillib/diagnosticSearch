<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: invertedIndex.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: invertedIndex.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @typedef {Object} IndexedTokenData Indexed document data of a specific token
 * @property {number} docCount The amount of docs that have this token
 * @property {Object&lt;string, DocData>} docs Dictionary[docId, DocData] The document data of this token.
 */

/**
 * @typedef {Object} DocData
 * @property {number} frequency amount of this token's occurrences in this document
 * @property {number} normalizedTF frequency divided by the amount of tokens in this document
 */

const config = require('config');
const _ = require('lodash');
const Json2File = require('./helpers/json2File');

/**
 * Represents an inverted index
 * @class
 */
class InvertedIndex {
    /**
     * Creates a inverted index object, tries to first load a saved copy from disk and map all unique document ids
     * @constructor
     */
    constructor() {
        const savedIndex = Json2File.loadFromTextSync(config.get('invertedIndex.store.path'));
        this._index = new Map(savedIndex || []);
        this._totalDocIds = _extractDocIds(this._index);
    }

    /**
     * The total amount of documents in the index
     *
     * @returns {number}
     */
    get totalDocCount() {
        return this._totalDocIds.size;
    }

    /**
     * Add an array of tokens from a single document to the index
     * @param {string} docId The id of the document which the tokens belong to
     * @param {Array&lt;string>} tokenArray Array of tokens to be indexed
     *
     * @returns {Promise} A promise that resolves when the index is saved to disk
     */
    addMultipleTokensForSingleDoc(docId, tokenArray) {
        const tokensWithFrequencies = _.countBy(tokenArray); //dictionary of &lt;token, frequency>
        _.forOwn(tokensWithFrequencies, (frequency, token) => this._addDocAndFrequencyToToken(token, docId, frequency, tokenArray.length));
        this._totalDocIds.add(docId);
        return this._saveIndex();
    }

    /**
     * Get indexed document data of a specific token
     * @param {string} token A token to return it's indexed document data
     *
     * @returns {IndexedTokenData | null}
     */
    getTokenDocs(token) {
        return this._index.get(token) || null;
    }

    _addDocAndFrequencyToToken(token, docId, frequency, tokenCountInDoc) {
        if (!this._index.has(token)) {
            this._index.set(token, {docs: {}, docCount: 0});
        }
        const indexedToken = this._index.get(token);
        indexedToken.docs[docId] = {frequency, normalizedTF: frequency / tokenCountInDoc};
        indexedToken.docCount++;
    }

    _saveIndex() {
        return Json2File.saveAsText(config.get('invertedIndex.store.path'), [...this._index]);
    }
}

module.exports = new InvertedIndex();

function _extractDocIds(invertedIndex) {
    const docIds = new Set();
    invertedIndex.forEach((tokenDocs, token) => {
        _.forEach(Object.keys(tokenDocs.docs), (docId) => {
            docIds.add(docId);
        });
    });
    return docIds;
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="DocStore.html">DocStore</a></li><li><a href="Indexer.html">Indexer</a></li><li><a href="InvertedIndex.html">InvertedIndex</a></li><li><a href="Searcher.html">Searcher</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Jun 17 2018 19:34:46 GMT+0300 (Israel Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
